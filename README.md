# OPC UA Information Model Visualizer

OPC UAの **Nodeset XMLファイル**（情報モデル）を読み込み、その構造（オブジェクト、変数、参照関係など）を **PDFファイル** として可視化して出力するツールです。

`node-opcua` を使用してモデルを解析し、標準のOPC UAネームスペース（ns=0）を除外することで、独自のモデル構造にフォーカスした図を生成します。

## 必要要件

- Node.js (v18以降推奨)

## インストール

プロジェクトのディレクトリで以下のコマンドを実行し、依存パッケージをインストールしてください。

```bash
npm install
```

※ Graphviz等の外部ツールのインストールは不要です（WebAssembly版を使用しています）。

## 使い方

以下のコマンドを実行して、XMLファイルをPDFに変換します。

```bash
npx ts-node index.ts <入力XMLファイル1> [入力XMLファイル2 ...] <出力PDFファイル>
```

### 引数
1. `<入力XMLファイル1> ...`: OPC UAのNodeset XMLファイルのパス (複数指定可)。依存関係がある場合は、依存されるファイルを先に指定することを推奨します。
2. `<出力PDFファイル>`: 生成するPDFファイルのパス (最後の引数)。

## 実行例

同梱されているテスト用のNodesetファイルを使用して動作を確認できます。

```bash
npx ts-node index.ts test_nodeset.xml output.pdf
```

成功すると、`Done!` と表示され、カレントディレクトリに `output.pdf` が生成されます。

## 仕組み

1. **パース**: `node-opcua` ライブラリを使用してXMLをメモリ上のAddressSpaceに展開します。
2. **グラフ生成**: 独自のネームスペース（ns > 0）に含まれるノードを走査し、ノードの種類（Object, Variable, DataTypeなど）に応じて色分けしたグラフ構造を作成します。
4. **レンダリング**: `@hpcc-js/wasm` (Graphviz) を使用してレイアウト計算を行い、`pdfkit` を使用してベクター形式のPDFとして保存します。

## テストの実行

ユニットテストを実行して、コードの品質と機能を検証できます。

```bash
npm test
```

これにより、Jestを使用したテストスイートが実行され、カバレッジレポートが表示されます。
本プロジェクトは、**80%以上のコードカバレッジ**を維持することを目標としています。

## 標準ノードセットについて

本ツールは、実行時に標準のOPC UA定義ファイル (`Opc.Ua.NodeSet2.xml`) を必須としています。
通常は `node-opcua` パッケージに含まれているものが自動的に読み込まれますが、もし見つからない場合はエラーとなります。
エラーが発生した場合は、`npm install` が正しく行われているか確認してください。
